
<script>
  let userRole=null;
    function parseJwt(token) {
      const parts = token.split('.');
      if (parts.length < 2) {
        throw new Error('Token invÃ¡lido, se esperaban al menos 2 partes');
      }
      const base64Url = parts[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      let jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        const hex = ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        return '%' + hex;
      }).join(''));
      jsonPayload = JSON.parse(jsonPayload);
      return jsonPayload;
    };

    
    const adminLink = document.createElement('li');

    adminLink.innerHTML = '<a class="ms-2" href="/UsersPanel">Admin:Users</a>';
    adminLink.innerHTML += '<a class="ms-2" href="/ProgramsPanel">Admin:Programs</a>';
    const logoutLink = document.createElement('li');
    logoutLink.innerHTML = '<a href="/logout">Logout</a>';

    const loginLink = document.createElement('li');
    loginLink.innerHTML = '<a href="/login">Login</a>';

    const registerLink = document.createElement('li');
    registerLink.innerHTML = '<a href="/registrar">Registrarse</a>';

</script>

<div style="float:right;">
  <audio controls autoplay muted playsinline volume="0.1">
    <source src="http://cdn.instream.audio:9288/stream" type="audio/mpeg">
    Tu navegador no soporta el elemento audio.
  </audio>
</div>

<h1>Radio</h1>
<h5>Tu lugar, tu musica</h4>
  <nav id="navbar">
    <ul id="lis2" class="gap-2">
    </ul>
    <ul id="lis">
      <li><a href="/">Home</a></li>
      <li><a href="/programas">Programas</a></li>
      <li><a href="/sobreNosotros">Sobre nosotros</a></li>
      <li><a href="/contactanos">Contactanos</a></li>
      <span id="login">
      <li><a href="/login">Login</a></li>
      <li><a href="/registrar">Registrarse</a></li>
      </span>
      <li id="logout"></li>
    </ul>


  </nav>
<script>
    const headers = new Headers();
    const authBar = document.getElementById('lis');

    const token = localStorage.getItem('token');

    const login = document.getElementById('login');
    const logout = document.getElementById('logout');
    const adminBar= document.getElementById('lis2');

    if(token)
    {
        const user = parseJwt(token);
        logout.innerHTML = '<a href="/logout">Logout</a>';
        login.innerHTML = '';
        userRole = user.userRole;
        if (userRole === 'admin') {
            adminBar.appendChild(adminLink);
        } 
    }
    else
    {
        console.log("no hay token")
                logout.innerHTML = '';
                login.innerHTML = `      <li><a href="/login">Login</a></li>
      <li><a href="/registrar">Registrarse</a></li>`;
                adminBar.innerHTML = '';
    }




</script>

